# Aura Countdown - 技术架构与开发指南

## 1. 技术栈

*   **核心框架**: [Electron](https://www.electronjs.org/) (v27+)
*   **前端框架**: [Vue 3](https://vuejs.org/) (Composition API)
*   **构建工具**: [Vite](https://vitejs.dev/)
*   **打包工具**: [electron-builder](https://www.electron.build/)
*   **语言**: JavaScript (ES Modules / CommonJS)

## 2. 架构设计

本项目采用标准的 Electron 双进程架构：

### 2.1 主进程 (Main Process)
*   **入口文件**: `src/main.cjs`
*   **职责**:
    *   **应用生命周期管理**: 处理 `ready`, `window-all-closed`, `before-quit` 等事件。
    *   **窗口管理**: 创建无边框、透明背景的 `BrowserWindow`，并处理其显示/隐藏逻辑。
    *   **系统托盘 (Tray)**: 创建状态栏图标，处理点击事件，动态更新 Tray 标题（显示置顶倒计时）。
    *   **数据持久化**: 使用 Node.js `fs` 模块读写本地 JSON 文件 (`countdowns.json`)。
    *   **IPC 通信**: 监听 `ipcMain` 事件，响应渲染进程的请求（获取、保存、删除、置顶数据）。
    *   **多屏幕适配**: 使用 `screen` API 计算窗口位置，确保在鼠标所在屏幕弹出。

### 2.2 渲染进程 (Renderer Process)
*   **入口文件**: `src/renderer.js` -> `src/App.vue`
*   **职责**:
    *   **UI 渲染**: 使用 Vue 3 构建响应式界面。
    *   **交互逻辑**: 处理用户点击、表单输入、模态框展示等。
    *   **实时更新**: 使用 `setInterval` 每分钟更新一次倒计时显示。
    *   **IPC 调用**: 通过 `window.electronAPI` 调用主进程能力。

### 2.3 预加载脚本 (Preload Script)
*   **文件**: `src/preload.cjs`
*   **职责**:
    *   作为主进程和渲染进程的安全桥梁。
    *   使用 `contextBridge` 将特定的 IPC 方法暴露给渲染进程 (`window.electronAPI`)。
    *   **安全策略**: 开启 `contextIsolation`，禁止渲染进程直接访问 Node.js API。

## 3. 核心功能实现逻辑

### 3.1 状态栏窗口切换 (Toggle Window)
*   **逻辑**: 点击 Tray 图标时，主进程计算 Tray 的坐标 (`tray.getBounds()`)。
*   **多屏幕处理**: 使用 `screen.getDisplayMatching(trayBounds)` 获取当前屏幕，确保窗口 x/y 坐标在当前屏幕范围内。
*   **显示/隐藏**: 如果窗口已显示，则隐藏；否则移动到计算出的位置并显示。

### 3.2 数据存储
*   **路径**: `app.getPath('userData') + '/countdowns.json'`。
*   **格式**:
    ```json
    [
      {
        "id": "1701500000000",
        "name": "Project Launch",
        "date": "2025-12-31T00:00",
        "startDate": "2025-01-01T00:00",
        "iconType": "rocket",
        "pinned": true,
        "createdAt": "..."
      }
    ]
    ```
*   **操作**: 主进程封装了 `loadCountdowns` 和 `saveCountdowns` 函数，通过 IPC 暴露给前端。

### 3.3 置顶功能 (Pinning)
*   **互斥逻辑**: `pin-countdown` IPC 接口在接收到置顶请求时，先将所有项的 `pinned` 设为 `false`，再将目标项设为 `true`。
*   **状态栏更新**: 每次数据变更（保存、删除、置顶）后，调用 `updateTrayTitle`。如果存在 `pinned: true` 的项，计算其剩余天数并显示；否则显示默认图标。

### 3.4 进度条计算
*   **公式**: `(当前时间 - 开始时间) / (目标时间 - 开始时间) * 100%`。
*   **兼容性**: 如果旧数据没有 `startDate`，前端会默认使用 `createdAt` 或目标时间前 30 天作为开始时间。

## 4. 样式与 UI 设计

*   **风格**: 现代、扁平化、高对比度。
*   **布局**: Flexbox 布局。
    *   **列表项**: 左图标 + 中间信息 + 右侧操作区。
    *   **操作区**: 垂直排列删除和置顶按钮，避免遮挡内容。
*   **配色**:
    *   背景: Slate 渐变 (`#F8FAFC` -> `#E2E8F0`)。
    *   主色: 靛蓝/紫罗兰渐变 (`#6366F1` -> `#8B5CF6`)。
*   **细节**:
    *   使用 `datetime-local` 原生控件并优化样式。
    *   隐藏滚动条但保留滚动功能。
    *   按钮添加悬停反馈和阴影。

## 5. 后续开发建议

1.  **开机自启**: 使用 Electron 的 `app.setLoginItemSettings` API 实现。
2.  **通知提醒**: 当倒计时结束时，发送系统通知 (`Notification` API)。
3.  **更多自定义**: 允许用户上传自定义图标或背景图。
4.  **国际化 (i18n)**: 提取文本资源，支持多语言切换。
5.  **快捷键**: 添加全局快捷键快速打开窗口。

---
*Generated by Droid*
